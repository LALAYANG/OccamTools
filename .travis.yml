sudo: false
dist: xenial
language: python
cache: pip

stages:
  - test
  - name: deploy
    if: tag IS present

jobs:
  include:
    - python: 3.6.6
    - python: 3.7.0
    - stage: test
      - install:
        - pip3 install codecov
        - pip3 install codacy-coverage
        - pip3 install -e .
      - script:
        - pytest -v -s --cov=./
      - after_success:
        - codecov -t $CODECOV_PROJECT_TOKEN
        - coverage xml
        - python-codacy-coverage -r coverage.xml
    - stage: deploy
      - script:
        - echo Deploying to PyPI

deploy:
  provider: pypi
  user: mortele
  password: $PYPI_PASSWORD
  on:
    tags: true
